#!/bin/bash -f
# ****************************************************************************
# Vivado (TM) v2021.2 (64-bit)
#
# Filename    : simulate.sh
# Simulator   : Cadence Xcelium Parallel Simulator
# Description : Script for simulating the design by launching the simulator
#
# Generated by Vivado on Fri Apr 18 13:13:42 CEST 2025
# SW Build 3367213 on Tue Oct 19 02:47:39 MDT 2021
#
# IP Build 3369179 on Thu Oct 21 08:25:16 MDT 2021
#
# usage: simulate.sh
#
# ****************************************************************************
set -Eeuo pipefail
# === Range of Fault IDs to Inject ===
START_FAULT_ID=46
END_FAULT_ID=94



# installation path setting
bin_path="/ihp/ihpusr/cadence/xcelium/20.09/tools.lnx86/bin"

# set xmsim command line args
xmsim_opts="-64bit -logfile simulate.log "

# set fault injection parameters


for (( fault_id=$START_FAULT_ID; fault_id<=$END_FAULT_ID; fault_id++ ))
do
    echo "==> Running Fault ID: $fault_id"
    # run simulation
        fi_opts="-fault_sim_run -fault_timeout 1000ns -fault_test strobe_test1 -fault_checker_on -fault_tw 50ns:350ns  -fault_strobe_data detect_verbose -fault_id $fault_id -fault_work fault_db4"

    if [ "$fault_id" -eq "$END_FAULT_ID" ]; then
        $bin_path/xmsim $xmsim_opts $fi_opts xil_defaultlib.mapper_tb -input mapper_tb_simulate_last_fault.do
    else
	$bin_path/xmsim $xmsim_opts $fi_opts xil_defaultlib.mapper_tb -input mapper_tb_simulate.do
    fi
    #Fault sim. commands definition :
    #-fault_sim_run: Enables serial fault simulation. Xcelium injects only a single fault for each fault simulation run.
   # -fault_timeout: Specifies the time, as an absolute time value, to terminate the simulation.
   # -fault_checker_on : Enables the alternative fault detection technique for the fs_strobe command.If you define strobe points to monitor as functional and checker outputs during the good simulation run,
   # those strobe points are used to help classify detected faults during fault simulation.
   # -fault_id: Injects faults by internal ID. With Xcelium, you can inject faults by an internal ID that corresponds to a unique fault node or by some random ID
   # -fault_work : Specifies a name for the output directory in which to save the results of each fault run.
  


    
done
#print="xfr -fault_work fault_db -fault_report  fault_report_test"
 #$bin_path/xmsim $print

echo "All fault injection runs completed."
